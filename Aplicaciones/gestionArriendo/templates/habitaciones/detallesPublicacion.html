{% extends 'habitaciones/plantilla.html' %}

{% block contenido %}
<!-- CSS de Owl Carousel -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- JS de Owl Carousel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <!-- Google Maps API -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPMAF9GQ1RsZognLTwwb7kYiT8SAfNZHo&callback=initMap"></script>

<br>
<style>
  .owl-carousel .item img {
    border-radius: 10px;
    background-color: #f9f9f9;
    padding: 10px;
  }
</style>

<div class="container mt-4">

{% if fotos %}
<div class="owl-carousel owl-theme mt-4 mb-5">
  {% for foto in fotos %}
    {% if foto.imagen %}
      <div class="item">
        <img src="{{ foto.imagen.url }}" alt="Imagen de publicación" class="img-fluid rounded" style="max-height: 400px; object-fit: contain;">
      </div>
    {% endif %}
  {% endfor %}
</div>
{% endif %}

  <div class="col-md-8 col-12 mb-4">
  

        <h2 ><strong>Precio:</strong> $ {{ publicacion.precio  }} / mes</h2>
          
          <p class="mt-1"><strong>Título:</strong> {{  publicacion.titulo}}</p>          

          <p class="mt-1"><strong>Tipo:</strong> {{ publicacion.tipohabitacion.nombre}}</p>           
          <p class="mt-1" style="font-size: 15px;"><strong>Descripción:</strong> {{ publicacion.descripcion|truncatechars:150 }}</p>
          <hr>
  


  </div>
 


 <br><br> <br><br> <br><br>
  <div class="mb-5">
    <br>
             <h2><strong>Ubicación:</strong> </h2>

    <div class="" id="mapa_cliente" style="border:1px solid black; height:300px;
    width:100%"> </div>
  </div>






  <br><br>

<div class="container mt-5">
  <!-- Sección de Comentarios -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Deja un comentario</h5>
    </div>
    <div class="card-body">
      <form action="/guardarComentario/{{ publicacion.id }}/" method="post" id="frm_comentario">
        {% csrf_token %}
        <div class="mb-3">
          <label for="comentario" class="form-label">Tu comentario:</label>
          <textarea id="comentario" name="comentario" class="form-control" rows="4" placeholder="Escribe tu opinión..." required></textarea>
        </div>
        <button type="submit" class="btn btn-success">
          <i class="fas fa-comment-dots"></i> Enviar Comentario
        </button>
      </form>
    </div>
  </div><br>

  <!-- Sección de Calificación -->
  <div class="card shadow-sm">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0">Califica esta publicación</h5>
    </div>
    <div class="card-body">
      <form action="/calificarPublicacion/{{ publicacion.id }}/" method="post" id="frm_calificacion">
        {% csrf_token %}
        <div class="mb-3">
          <label for="calificacion" class="form-label">Selecciona una calificación:</label>
          <select id="calificacion" name="calificacion" class="form-select" required>
            <option value="" disabled selected>-- Escoge una opción --</option>
            <option value="1">1 - Muy malo</option>
            <option value="2">2 - Malo</option>
            <option value="3">3 - Regular</option>
            <option value="4">4 - Bueno</option>
            <option value="5">5 - Excelente</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-star"></i> Enviar Calificación
        </button>
      </form>
    </div>
  </div>
</div>


</div>
 
<script>
  $(document).ready(function(){
    $(".owl-carousel").owlCarousel({
      loop: true,
      margin: 10,
      nav: true,
      dots: true,
      autoplay: true,
      autoplayTimeout: 4000,
      autoplayHoverPause: true,
      responsive:{
        0: { items: 1 },
        768: { items: 1 },
        1024: { items: 1 }
      }
    });
  });
</script>

<script type="text/javascript">
    function initMap() {
        
     
        var lat = parseFloat("{{ publicacion.latitud }}".replace(",", "."));
        var lng = parseFloat("{{ publicacion.longitud }}".replace(",", "."));

        console.log("Latitud:", lat, "Longitud:", lng); 

        var latitud_longitud = new google.maps.LatLng(lat, lng);

        var mapa = new google.maps.Map(document.getElementById('mapa_cliente'), {
            center: latitud_longitud,
            zoom: 15,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

       var marcador = new google.maps.Marker({
            position: latitud_longitud,
            map: mapa,
            title: "Ubicación de la publicación",
            draggable: false  
        });


        google.maps.event.addListener(marcador, 'dragend', function(event) {
            var latitud = this.getPosition().lat();
            var longitud = this.getPosition().lng();
            document.getElementById("latitud").value = latitud;
            document.getElementById("longitud").value = longitud;
        });
    }
</script>
{% endblock %}

